<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Loading...</title>
  <link id="favicon" rel="icon" type="image/png" href="timenow/imgs/default.png">
  <link href="https://fonts.googleapis.com/css2?family=Open+Sans:wght@400;600&display=swap" rel="stylesheet">
  <style>
    * {
      box-sizing: border-box;
    }

    body {
      margin: 0;
      padding: 0;
      background: #fff;
      color: #333;
      font-family: 'Montserrat', sans-serif;
      height: 100vh;
      display: flex;
      transition: background 0.3s, color 0.3s;
      overflow: hidden;
    }

    .sidebar,
    .sidebar input,
    .sidebar select,
    .sidebar label,
    .sidebar h3 {
      font-family: 'Open Sans', system-ui, -apple-system, BlinkMacSystemFont, sans-serif;
    }

    .sidebar {
      width: 250px;
      background: rgba(255, 255, 255, 0.95);
      padding: 20px;
      box-shadow: 2px 0 10px rgba(0, 0, 0, 0.1);
      position: fixed;
      left: 0;
      top: 0;
      bottom: 0;
      z-index: 1000;
      font-size: 18px;
      transition: transform 0.3s ease, background 0.3s, color 0.3s;
      transform: translateX(-100%);
    }

    .sidebar.open {
      transform: translateX(0);
    }

    .sidebar input, .sidebar select {
      margin-right: 10px;
      margin-bottom: 10px;
    }

    .sidebar input[type="checkbox"] {
      transform: scale(1.3);
      margin-right: 8px;
      cursor: pointer;
    }

    .sidebar h3 {
      font-size: 1.25em;
      margin-bottom: 12px;
    }


    .dark-mode .sidebar {
      background: rgba(30, 30, 30, 0.95);
      color: #f0f0f0;
    }

    .clock-container {
      flex-grow: 1;
      display: flex;
      flex-direction: column;
      justify-content: center;  /*                                                       in desktop view* */
      align-items: center;  /*                                                           â†“                */
      margin-left: 0px !important; /* Prevent clock from offsetting to the right a little (v2.2b, 2c48e7d issue) */
      transition: transform 0.3s ease;
      transform-origin: center center;
      height: 100vh;
      overflow: hidden;
    }

    #time {
      font-size: 10vw;
      font-weight: 900;
      line-height: 1;
    }

    #milliseconds {
      font-size: 2vw;
      font-weight: 300;
      margin-top: 10px;
      display: none;
    }

    #date {
      font-size: clamp(16px, 1.9vw, 28px);
      font-weight: 300;
      margin-top: 20px;
    }

    .dark-mode {
      background: #121212;
      color: #f0f0f0;
    }
    
    #toggleSidebarBtn {
      position: fixed;
      bottom: 20px;
      left: 20px;
      z-index: 1100;
      font-size: 24px;
      padding: 10px 14px;
      border: none;
      border-radius: 50%;
      background-color: #f0f0f0;
      color: #333;
      cursor: pointer;
      box-shadow: 0 0 10px rgba(0,0,0,0.2);
      transition: background 0.3s, opacity 0.5s ease;
    }
    #toggleSidebarBtn:hover {
      background-color: #ddd;
    }
    .dark-mode #toggleSidebarBtn {
      background-color: #222;
      color: #eee;
    }
    .dark-mode #toggleSidebarBtn:hover {
      background-color: #333;
    }

    @media (max-width: 768px) {
      #time {
        font-size: 20vw;
        font-weight: 700;
        line-height: 1;
      }

      #milliseconds {
        font-size: 5vw;
      }

      #date {
        font-size: 4vw;
      }

      .sidebar {
        font-size: 14px;
        width: 200px;
      }
    }

      .clock-container {
        margin-left: 200px;
      }

    #exitFullscreenBtn {
      position: fixed;
      top: 20px;
      right: 20px;
      z-index: 1100;
      font-size: 26px;
      padding: 12px 16px;
      border: none;
      border-radius: 50%;
      background-color: #f0f0f0;
      color: #333;
      cursor: pointer;
      box-shadow: 0 0 10px rgba(0,0,0,0.2);
      opacity: 0;
      pointer-events: none;
      transition: opacity 0.5s ease, background 0.3s;
    }

    #exitFullscreenBtn:hover {
      background-color: #ddd;
    }

    .dark-mode #exitFullscreenBtn {
      background-color: #222;
      color: #eee;
    }

    .dark-mode #exitFullscreenBtn:hover {
      background-color: #333;
    }

    #exitFullscreenBtn {
      position: fixed;
      top: 20px;
      right: 20px;
      z-index: 1100;
      font-size: 26px;
      padding: 12px 16px;
      border: none;
      border-radius: 50%;
      background-color: #fff;
      color: #FF7F7F;
      cursor: pointer;
      box-shadow: 0 0 10px rgba(0,0,0,0.2);
      opacity: 0;
      pointer-events: none;
      transition: opacity 0.5s ease, background 0.3s, color 0.3s;
    }

    #privacyBanner {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      background: rgba(252, 114, 114, 0.65);
      font-family: Arial, Helvetica, sans-serif;
      text-align: center;
      padding: 10px 16px;
      z-index: 1200;
      cursor: pointer;
      box-shadow: 0 2px 6px rgba(0, 0, 0, 0.2);
    }

    #privacyBanner .banner-main {
      color: #000;
      font-size: 14px;
    }

    #privacyBanner .banner-sub {
      margin-top: 4px;
      font-size: 12px;
      color: #1a1a1a;
      opacity: 0.6;
    }

    #buildInput {
      padding: 5px 8px;
      font-size: 14px;
      border: 1px solid #ccc;
      border-radius: 4px;
      width: 150px;
      background-color: #fff;
      color: #333;
    }

    .dark-mode #buildInput {
      background-color: #333;
      color: #eee;
      border: 1px solid #555;
    }

    .dark-mode #exitFullscreenBtn {
      background-color: #222;
      color: darkred;
    }

    #fullscreenBtn {
      position: fixed;
      top: 20px;
      right: 20px; 
      z-index: 1100;
      font-size: 26px;
      padding: 12px 16px;
      border: none;
      border-radius: 50%;
      background-color: #90D5FF;
      color: #fff;
      cursor: pointer;
      box-shadow: 0 0 10px rgba(0,0,0,0.2);
      transition: background 0.3s, color 0.3s;
    }

    .dark-mode #fullscreenBtn {
      background-color: #00008B;
      color: #fff;
    }


    body.hide-cursor {
      cursor: none !important;
    }
  /*Montserrat*/
  @font-face { 
    /* Date face font (below time) */
    font-family: 'Montserrat';
    src: url('./fonts/Montserrat-SemiBold.ttf') format('truetype');
    font-weight: 600;
  }

  @font-face {
    /* Time face font */
    font-family: 'Montserrat';
    src: url('./fonts/Montserrat-ExtraBold.ttf') format('truetype');
    font-weight: 700;
  }

  /*D-Din*/
  @font-face {
    font-family: 'DDin';
    src: url('.fonts/DDin-SemiBold.otf') format('opentype');
    font-weight: 600;
  }

  @font-face {
    font-family: 'DDin';
    src: url('./fonts/DDin-ExtraBold.otf') format('opentype');
    font-weight: 700;
  }

  /* Source Sans Pro */
  @font-face {
    font-family: 'SourceSans3';
    src: url('./fonts/SourceSans3-SemiBold.ttf') format('truetype');
    font-weight: 600;
  }
  @font-face {
    font-family: 'SourceSans3';
    src: url('./fonts/SourceSans3-ExtraBold.ttf') format('truetype');
    font-weight: 700;
  }

  /* Inconsolata */
  @font-face {
    font-family: 'Inconsolata';
    src: url('./fonts/Inconsolata-SemiBold.ttf') format('truetype'); /* for 600 weight */
    font-weight: 600;
  }
  @font-face {
    font-family: 'Inconsolata';
    src: url('./fonts/Inconsolata-ExtraBold.ttf') format('truetype'); /* for 700 weight */
    font-weight: 700;
  }
  </style>
</head>
<body>
  <div id="privacyBanner">
    <div class="banner-main">
      This website uses your data solely for counting website traffic data.
      <strong>No personal data is collected.</strong>
    </div>
    <div class="banner-sub" id="bannerCountdown">
      This banner will auto hide in 10s. Click on the banner to hide it manually.
    </div>
  </div>

  <button id="exitFullscreenBtn" title="Exit Fullscreen">&times;</button>
  <button id="fullscreenBtn" title="Fullscreen">&#x26F6;</button>

  <button id="toggleSidebarBtn" title="Settings">&#9881;</button>
  <div class="sidebar" id="settingsPanel">
    <h3>Settings</h3>
    <label><input type="checkbox" id="formatToggle"> 12-hour format</label><br>
    <label><input type="checkbox" id="darkModeToggle"> Dark mode</label><br>
    <label><input type="checkbox" id="msToggle"> Show milliseconds</label><br>
    <label>
      Zoom:
      <select id="zoomSelect">
        <option value="1">1x</option>
        <option value="1.25">1.25x</option>
        <option value="1.5">1.5x</option>
        <option value ="1.75">1.75x</option>
        <option value="2">2x</option>

      </select>
    </label>
    <br>
    <label>
      Clock Font:
      <select id="clockFontSelect">
        <option value="Montserrat">Montserrat</option>
        <option value="DDIN">D-DIN</option>
        <option value="SourceSans3">Source Sans 3</option>
        <option value="Inconsolata">Inconsolata</option>
      </select>
    </label>
    <br>
    <label>
      Build:
      <input type="text" id="buildInput" value="production" />
    </label>
  </div>

  <div class="clock-container" id="clockContainer">
    <div id="time">--:--:--</div>
    <div id="milliseconds"></div>
    <div id="date">Loading date...</div>
  </div>

  <script> // Javascript goes here...
    const timeEl = document.getElementById('time');
    const msEl = document.getElementById('milliseconds');
    const dateEl = document.getElementById('date');
    const clockContainer = document.getElementById('clockContainer');

    const formatToggle = document.getElementById('formatToggle');
    const darkModeToggle = document.getElementById('darkModeToggle');
    const msToggle = document.getElementById('msToggle');
    const zoomSelect = document.getElementById('zoomSelect');

    const sidebar = document.getElementById('settingsPanel');
    const toggleBtn = document.getElementById('toggleSidebarBtn');
    const exitBtn = document.getElementById('exitFullscreenBtn');
    const fullscreenBtn = document.getElementById('fullscreenBtn');

    const buildInput = document.getElementById('buildInput');
    const loadBuildBtn = document.getElementById('loadBuildBtn');

    const clockFontSelect = document.getElementById('clockFontSelect');

    let is12Hour = false;
    let showMilliseconds = false;
    let darkMode = false;
    let zoomLevel = 1;

    let sidebarTimeout;
    let btnTimeout;

    let exitBtnTimeout;

    let timeOffset = 0;

    let cursorTimeout;
    let cursorHidden = false;


    function updateClock() {
      const now = new Date();
      let hours = now.getHours();
      const minutes = String(now.getMinutes()).padStart(2, '0');
      const seconds = String(now.getSeconds()).padStart(2, '0');
      const milliseconds = String(now.getMilliseconds()).padStart(3, '0');
    
      let suffix = '';
      if (is12Hour) {
        suffix = hours >= 12 ? ' PM' : ' AM';
        hours = hours % 12 || 12;
      }
    
      timeEl.textContent = `${String(hours).padStart(2, '0')}:${minutes}:${seconds}${suffix}`;
    
      if (showMilliseconds) {
        msEl.style.display = 'block';
        msEl.textContent = milliseconds;
      } else {
        msEl.style.display = 'none';
      }
    
      const options = { weekday: 'long', day: 'numeric', month: 'long', year: 'numeric' };
      dateEl.textContent = now.toLocaleDateString(undefined, options);
    }

    function resetCursorTimer() {
        clearTimeout(cursorTimeout);

        if (cursorHidden) {
          document.body.classList.remove('hide-cursor');
          cursorHidden = false;
        }

        cursorTimeout = setTimeout(() => {
          document.body.classList.add('hide-cursor');
          cursorHidden = true;
        }, 15000); // 15 seconds
      }

  async function syncNetworkTime() {
    try {
      const res = await fetch("https://worldtimeapi.org/api/ip");
      if (!res.ok) throw new Error("worldtimeapi failed");
      return await res.json();
    } catch {
      // fallback to timeapi.io
      const res = await fetch("https://timeapi.io/api/Time/current/ip");
      return await res.json();
    }
  }

    function showExitButton() {
      if (!document.fullscreenElement) return;
      exitBtn.style.opacity = '1';
      exitBtn.style.pointerEvents = 'auto';
      clearTimeout(exitBtnTimeout);
      exitBtnTimeout = setTimeout(() => hideExitButton(), 10000);
    }

    function hideExitButton() {
      exitBtn.style.opacity = '0';
      exitBtn.style.pointerEvents = 'none';
    }

    setInterval(updateClock, 50);
    updateClock();

    function loadBuild() {
      const buildName = buildInput.value.trim().toLowerCase();
      if (buildName === 'production') {
        if (!window.location.href.endsWith('index.html') &&
            !window.location.href.endsWith('/')) {
          window.location.href = 'https://clocktimenow.github.io/current.time';
        }
      } else if (buildName === 'publictesting') {
        window.location.href = 'https://clocktimenow.github.io/current.time/extrabuilds/404.html';
      } else {
        alert('Unknown build! Enter a valid production build.');
      }
    }

    buildInput.addEventListener('keydown', (e) => {
      if (e.key === 'Enter') loadBuild();
    });


    function updateFaviconAndTitle() {
      const now = new Date();
      const hours = now.getHours();
    
      const faviconEl = document.getElementById('favicon');
      let faviconPath = '';
      let titleText = '';
    
      if (hours >= 0 && hours < 3) {
        faviconPath = 'https://raw.githubusercontent.com/webclasstools/current.time/refs/heads/main/imgs/status_evening.png';
        titleText = 'Good night!';
      } else if (hours >= 3 && hours < 12) {
        faviconPath = 'https://raw.githubusercontent.com/webclasstools/current.time/refs/heads/main/imgs/status_evening_solar_noon.png';
        titleText = 'Good morning!';
      } else if (hours >= 12 && hours < 18) {
        faviconPath = 'https://raw.githubusercontent.com/webclasstools/current.time/refs/heads/main/imgs/status_morning.png';
        titleText = 'Good afternoon!';
      } else {
        faviconPath = 'https://raw.githubusercontent.com/webclasstools/current.time/refs/heads/main/imgs/status_evening.png';
        titleText = 'Good evening!';
      }
    
      faviconEl.href = faviconPath;
      document.title = titleText;
    }

    formatToggle.addEventListener('change', () => {
      is12Hour = formatToggle.checked;
    });

    darkModeToggle.addEventListener('change', () => {
      darkMode = darkModeToggle.checked;
      document.body.classList.toggle('dark-mode', darkMode);
    });

    msToggle.addEventListener('change', () => {
      showMilliseconds = msToggle.checked;
    });

    zoomSelect.addEventListener('change', () => {
      zoomLevel = parseFloat(zoomSelect.value);
      clockContainer.style.transform = `scale(${zoomLevel})`;
    });

    function resetSidebarTimer() {
      clearTimeout(sidebarTimeout);
      sidebarTimeout = setTimeout(() => {
        sidebar.classList.remove('open');
        clockContainer.style.marginLeft = '0';
        resetButtonTimer();
      }, 5000);
    }

    function showToggleButton() {
      toggleBtn.style.opacity = '1';
      toggleBtn.style.pointerEvents = 'auto';
    }

    function hideToggleButton() {
      toggleBtn.style.opacity = '0';
      toggleBtn.style.pointerEvents = 'none';
    }

    function resetButtonTimer() {
      clearTimeout(btnTimeout);
      showToggleButton();
      btnTimeout = setTimeout(() => {
        hideToggleButton();
      }, 5000);
    }

    function resetSidebarTimer() {
      clearTimeout(sidebarTimeout);
      sidebarTimeout = setTimeout(() => {
        sidebar.classList.remove('open');
        clockContainer.style.marginLeft = '0';
        resetButtonTimer();
      }, 5000);
    }

    function enterFullscreen() {
      if (!document.fullscreenElement) {
        document.documentElement.requestFullscreen();
      }
    }

    function exitFullscreen() {
      if (document.fullscreenElement) {
        document.exitFullscreen();
      }
    }

    fullscreenBtn.addEventListener('click', enterFullscreen);
    exitBtn.addEventListener('click', exitFullscreen);

    document.addEventListener('keydown', (e) => {
      if (e.key.toLowerCase() === 'f') {
        if (!document.fullscreenElement) {
          enterFullscreen();
        } else {  
          exitFullscreen();
        }
      }
    });

    document.addEventListener('fullscreenchange', () => {
      if (document.fullscreenElement) {
        // In fullscreen
        exitBtn.style.color = darkMode ? 'darkred' : 'red';
        fullscreenBtn.style.display = 'none';
        showExitButton();
      } else {
        exitBtn.style.color = darkMode ? '#222' : '#f0f0f0';
        fullscreenBtn.style.display = 'block';
        hideExitButton();
      }
    });
    
    toggleBtn.addEventListener('click', () => {
      const isOpen = sidebar.classList.toggle('open');
      clockContainer.style.marginLeft = isOpen ? '250px' : '0';
    
      if (isOpen) {
        resetSidebarTimer();
      } else {
        clearTimeout(sidebarTimeout);
      }
      resetButtonTimer();
    });

    document.addEventListener('mousemove', resetButtonTimer);

    document.addEventListener('dblclick', () => {
      if (!document.fullscreenElement) {
        document.documentElement.requestFullscreen();
      }
    });

    sidebar.addEventListener('mousemove', () => {
      resetSidebarTimer();
      resetButtonTimer();
    });
    sidebar.addEventListener('keydown', () => {
      resetSidebarTimer();
      resetButtonTimer();
    });

    document.addEventListener('mousemove', showExitButton);

    exitBtn.addEventListener('click', () => {
      document.exitFullscreen();
    });

    document.addEventListener('fullscreenchange', () => {
      if (document.fullscreenElement) {
        showExitButton();
      } else {
        hideExitButton();
      }
    });

    document.addEventListener('mousemove', resetCursorTimer);
    document.addEventListener('mousedown', resetCursorTimer);
    document.addEventListener('keydown', resetCursorTimer);

    clockFontSelect.addEventListener('change', () => {
      const selectedFont = clockFontSelect.value;
      timeEl.style.fontFamily = selectedFont; // 700 weight
      dateEl.style.fontFamily = selectedFont; // 600 weight
    });

    (function () {
      const banner = document.getElementById('privacyBanner');
      const countdownEl = document.getElementById('bannerCountdown');
      if (!banner || !countdownEl) return;
    
      let seconds = 10;
      countdownEl.textContent =
        `This banner will auto hide in ${seconds}s. Click on the banner to hide it manually.`;
    
      const interval = setInterval(() => {
        seconds--;
        if (seconds <= 0) {
          clearInterval(interval);
        } else {
          countdownEl.textContent =
            `This banner will auto hide in ${seconds}s. Click on the banner to hide it manually.`;
        }
      }, 1000);
    
      function removeBanner() {
        clearInterval(interval);
        banner.style.transition = 'opacity 0.3s ease';
        banner.style.opacity = '0';
        setTimeout(() => banner.remove(), 300);
      }
    
      banner.addEventListener('click', removeBanner);
      setTimeout(removeBanner, 10000);
    })();
    
    resetButtonTimer();
    resetCursorTimer();
    
    syncNetworkTime();
    setInterval(syncNetworkTime, 10 * 60 * 1000);

    updateFaviconAndTitle();
    setInterval(updateFaviconAndTitle, 1000);
  </script>
  <!-- Cloudflare Web Analytics -->
  <script defer src='https://static.cloudflareinsights.com/beacon.min.js' data-cf-beacon='{"token": "a4725cc1c1db4e859650a1e8a4a1a4a2"}'></script><!-- End Cloudflare Web Analytics -->
</body>
</html>
